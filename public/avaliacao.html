<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="./script/sideBar.js"></script>
    <link rel="stylesheet" href="style/avaliacao.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Konkhmer+Sleokchher&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap ">
    <title>Avaliar Plataforma Fraux</title>
</head>
<body>

    <side-Bar></side-Bar>

    <div class="header">
        <div class="btn">
            <button id="btn_notificacao" class="btn_sino" onclick="notificacao()">
                <img src="img/notification-bell.png" alt="Notificacoes">
            </button>
            <span id="span_bem_vindo"></span>
        </div>
    </div>
<div class="container">
    <div class="container-avaliacao">
       
        <div class="titulo-logo">
            <img width="60px" src="./img/fraux-logo.png">
            <h1>FRAUX</h1>
        </div>

        <div class="mensagem">
            <span>Conte-nos como foi usar nossa aplicação, seu feedback nos ajuda a melhorar.</span>
        </div>

         <div class="campo">
                    <ul class="avaliacao" id="1">
                        <li class="star-icon" data-avaliacao="1"></li>
                        <li class="star-icon" data-avaliacao="2"></li>
                        <li class="star-icon" data-avaliacao="3"></li>
                        <li class="star-icon" data-avaliacao="4"></li>
                        <li class="star-icon" data-avaliacao="5"></li>
                    </ul>
        </div>

        <div class="comentario">
            <textarea placeholder="Observações" id="coment" rows=5 cols=25></textarea>
        </div>

        <div class="botao-feedback">
            <button class="btn-avaliar" onclick="avaliar()">Enviar Feedback</button>
        </div>

    </div>
</div>
    
</body>
</html>
<script>

    let notaAtual = 0;
    const estrelas = document.querySelectorAll('.star-icon');
    
    estrelas.forEach(estrela => {
        estrela.addEventListener('click', function() {
            const valor = parseInt(this.getAttribute('data-avaliacao'));
            notaAtual = valor;

            atualizarEstrelas(notaAtual);
        });
    });

    function atualizarEstrelas(nota) {
        estrelas.forEach(estrela => {
            const valorEstrela = parseInt(estrela.getAttribute('data-avaliacao'));
            
            if (valorEstrela <= nota) {
                estrela.classList.add('ativo');
            } else {
                estrela.classList.remove('ativo');
            }
        });
    }

    function avaliar() {
        const comentario = document.getElementById('coment').value;
        const idUsuario = sessionStorage.ID_USUARIO; 
        if (notaAtual === 0) {
            alert("Por favor, selecione uma quantidade de estrelas!");
            return;
        }
        if (idUsuario == undefined) {
            alert("Erro: Usuário não identificado. Faça login novamente.");
            return;
        }

        fetch("/avaliacao/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                nota: notaAtual,
                descricao: comentario,
                idUsuario: idUsuario
            }),
        })
        .then(function (resposta) {
            if (resposta.ok) {
                alert("Avaliação enviada com sucesso! Obrigado pelo feedback.");
                window.location.href = "painelPerformanceRisco.html";
            } else {
                throw "Erro ao enviar avaliação";
            }
        })
        .catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            alert("Erro ao enviar avaliação. Tente novamente.");
        });
    }

</script>